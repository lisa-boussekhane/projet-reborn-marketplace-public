--------------------------------
-- STRUCTURE de la base de la BDD
--------------------------------

DROP TABLE IF EXISTS "user", "media", "detail_product", "product", "message", "shop", "order", "dispatch";

CREATE TABLE "user" (
  "id" INTEGER NOT NULL GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
  "first_name" VARCHAR(128) NOT NULL,
  "last_name" VARCHAR(128) NOT NULL,
  "username" VARCHAR(128) NOT NULL,
  "email" VARCHAR(128) NOT NULL,
  "date_of_birth" TIMESTAMPTZ NOT NULL,
  "phone" VARCHAR(11) NOT NULL,
  "address" VARCHAR(128) NOT NULL,
  "zip_code" VARCHAR(9) NOT NULL,
  "city" VARCHAR(128) NOT NULL,
  "state" VARCHAR(128) NOT NULL,
  "role" VARCHAR(128) NOT NULL,
  "duns" INTEGER NOT NULL,
  "created_at" TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP,
  "updated_at" TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE "media" (
  "id" INTEGER NOT NULL GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
  "photo" PATH NOT NULL,
  "video" PATH NOT NULL,
  "created_at" TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP,
  "updated_at" TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE "product" (
  "id" INTEGER NOT NULL GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
  "security_code" INTEGER NOT NULL,
  "title" VARCHAR(100) NOT NULL,
  "kit_name" VARCHAR(20) NOT NULL,
  "sculptor" VARCHAR(50) NOT NULL,
  "size" INTEGER NOT NULL,
  "type" VARCHAR(100) NOT NULL,
  "age_range" VARCHAR(100) NOT NULL,
  "authenticity_card" BOOLEAN NOT NULL,
  "price" INTEGER NOT NULL,
  "shipping_fees" INTEGER,
  "created_at" TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP,
  "updated_at" TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE "detail_product" (
  "id" INTEGER NOT NULL GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
  "localization" VARCHAR(50) NOT NULL,
  "belly_plate" BOOLEAN NOT NULL,
  "gender" VARCHAR(10) NOT NULL,
  "year" INTEGER NOT NULL,
  "eyes" VARCHAR(100) NOT NULL,
  "hair" VARCHAR(100) NOT NULL,
  "status" VARCHAR(50) NOT NULL,
  "created_at" TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP,
  "updated_at" TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE "shop" (
  "id" INTEGER NOT NULL GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
  "name" VARCHAR(50) NOT NULL,
  "link_seller_profile" PATH NOT NULL,
  "created_at" TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP,
  "updated_at" TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE "message" (
  "id" INTEGER NOT NULL GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
  "content" VARCHAR(200) NOT NULL,
  "created_at" TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP,
  "updated_at" TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP
);

--------------------------------
-- Tables de liaison
--------------------------------

CREATE TABLE "order"(
  "id" INTEGER NOT NULL GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
  "user_id" INTEGER NOT NULL REFERENCES "user"("id") ON DELETE CASCADE,
  "shop_id" INTEGER NOT NULL REFERENCES "shop"("id") ON DELETE CASCADE,
  "date" TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP,
  "invoice" PATH,
  "status" VARCHAR(100) NOT NULL
  );

CREATE TABLE "dispatch"(
  "id" INTEGER NOT NULL GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
  "message_id" INTEGER NOT NULL REFERENCES "message"("id") ON DELETE CASCADE,
  "product_id" INTEGER NOT NULL REFERENCES "product"("id") ON DELETE CASCADE
  );